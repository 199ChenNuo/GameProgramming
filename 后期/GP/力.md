# F_beam

> Node.cs

在EventController.cs中每一次update时显示更新F_beam.

遍历所有的点，每次遍历时更新F_beam

```c#
// EventController.cs @ update()
void Update()
{
    // 计算 F_axial
    for(int i=0; i<nodes.Count; ++i)
    {
        nodes[i].updateF_axial();
    }
    // ...
}
```

```c#
// Node.cs @ updateF_axial()
public void updateF_axial()
{
    this.F_axial = Vector3.zero;
    for(int i=0; i<beams.Count; ++i)
    {
        Beam b = beams[i];
        this.F_axial += b.getF(this);
    }
}
```

```c#
// Beam.cs @ getF(Node n)
public Vector3 getF(Node n)
{
    Vector3 I12 = (n1.position - n2.position).normalized;
    if (n == n1)
    {
        I12 = (n2.position - n1.position).normalized;
    }

    return -k_axial * (l - l_0) * I12;
}
```



# F_face

> Face.cs



![](.\img\alpha.png)

在EventController.cs中遍历所有的面更新F_face

```c#
// EventController.cs @ update()
void update(){
    // 计算 F_face
    for(int i=0; i<faces.Count; ++i)
    {
        // TBD
        faces[i].updateF_face();
    }
    // ...
}
```



在Face.cs中，遍历面内的三个角，每次遍历时都为每个node更新F_face

```c#
// Face.cs @ updateF_face()
public void updateF_face()
{
    // boundary face, return
    if (nodes.Count != 3)
        return;

    // update 3 current alpha of this face
    updateAlpha();
    // update normal vector of this face
    updateN();
    // remove previous f_face of nodes
    clearF_face();

    for(int i=0; i<3; ++i)
    {
        // notice that alpha has +/-

        // alpha: the angle from (p2-p1) to (p2-p3)
        // e.g. 
        //     p1: nodes[(i+2)%3].pos
        //     p2: nodes[i].pos
        //     p3: nodes[(i+1)%3].pos 

        // f_face for p1
        nodes[(i + 2) % 3].F_face += getAlphaODE1(n, nodes[(i + 2) % 3].position, nodes[i].position);
        // f_face for p2
        nodes[i].F_face += getAlphaODE2(n, nodes[(i + 2) % 3].position,
                                                                    nodes[i].position, nodes[(i + 1) % 3].position);
        // f_face for p3
        nodes[(i + 1) % 3].F_face += getAlphaODE3(n, nodes[i].position, nodes[(i + 1) % 3].position);
    }
}
```



